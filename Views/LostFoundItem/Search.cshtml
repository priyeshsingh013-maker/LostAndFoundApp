@model SearchViewModel
@{
    ViewData["Title"] = "Search Records";
}

<div class="page-header">
    <div class="container-fluid px-4">
        <div class="d-flex justify-content-between align-items-center" style="flex-wrap:wrap; gap:12px;">
            <div>
                <h1><i class="bi bi-search me-2"></i>Search Records</h1>
                <p class="subtitle mb-0">@Model.TotalRecords record(s) found</p>
            </div>
            @if (Model.Results.Any())
            {
                <a asp-action="PrintSearch"
                   asp-route-TrackingId="@Model.TrackingId"
                   asp-route-DateFoundFrom="@Model.DateFoundFrom?.ToString("yyyy-MM-dd")"
                   asp-route-DateFoundTo="@Model.DateFoundTo?.ToString("yyyy-MM-dd")"
                   asp-route-ItemId="@Model.ItemId"
                   asp-route-StatusId="@Model.StatusId"
                   asp-route-RouteId="@Model.RouteId"
                   asp-route-VehicleId="@Model.VehicleId"
                   asp-route-StorageLocationId="@Model.StorageLocationId"
                   asp-route-FoundById="@Model.FoundById"
                   class="btn btn-light rounded-pill px-3" target="_blank">
                    <i class="bi bi-printer"></i> Print
                </a>
            }
        </div>
    </div>
</div>

<div class="container-fluid px-4">
    <!-- Filters -->
    <div class="card mb-3 fade-in-up">
        <div class="card-body">
            <form method="get" asp-action="Search">
                <div class="row g-3 align-items-end">
                    <div class="col-md-2">
                        <label class="form-label">Tracking ID</label>
                        <input type="number" name="TrackingId" value="@Model.TrackingId" class="form-control" placeholder="#" />
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Date From</label>
                        <input type="date" name="DateFoundFrom" value="@Model.DateFoundFrom?.ToString("yyyy-MM-dd")" class="form-control" />
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Date To</label>
                        <input type="date" name="DateFoundTo" value="@Model.DateFoundTo?.ToString("yyyy-MM-dd")" class="form-control" />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Item Type</label>
                        <select name="ItemId" class="form-select">
                            <option value="">All</option>
                            @if (Model.Items != null)
                            {
                                @foreach (var item in Model.Items)
                                {
                                    <option value="@item.Value" selected="@(item.Value == Model.ItemId?.ToString() ? "selected" : null)">@item.Text</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Status</label>
                        <select name="StatusId" class="form-select">
                            <option value="">All</option>
                            @if (Model.Statuses != null)
                            {
                                @foreach (var status in Model.Statuses)
                                {
                                    <option value="@status.Value" selected="@(status.Value == Model.StatusId?.ToString() ? "selected" : null)">@status.Text</option>
                                }
                            }
                        </select>
                    </div>
                </div>
                <div class="row g-3 align-items-end mt-1">
                    <div class="col-md-3">
                        <label class="form-label">Route</label>
                        <select name="RouteId" class="form-select">
                            <option value="">All</option>
                            @if (Model.Routes != null)
                            {
                                @foreach (var route in Model.Routes)
                                {
                                    <option value="@route.Value" selected="@(route.Value == Model.RouteId?.ToString() ? "selected" : null)">@route.Text</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Vehicle</label>
                        <select name="VehicleId" class="form-select">
                            <option value="">All</option>
                            @if (Model.Vehicles != null)
                            {
                                @foreach (var vehicle in Model.Vehicles)
                                {
                                    <option value="@vehicle.Value" selected="@(vehicle.Value == Model.VehicleId?.ToString() ? "selected" : null)">@vehicle.Text</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Storage Location</label>
                        <select name="StorageLocationId" class="form-select">
                            <option value="">All</option>
                            @if (Model.StorageLocations != null)
                            {
                                @foreach (var loc in Model.StorageLocations)
                                {
                                    <option value="@loc.Value" selected="@(loc.Value == Model.StorageLocationId?.ToString() ? "selected" : null)">@loc.Text</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Found By</label>
                        <select name="FoundById" class="form-select">
                            <option value="">All</option>
                            @if (Model.FoundByNames != null)
                            {
                                @foreach (var person in Model.FoundByNames)
                                {
                                    <option value="@person.Value" selected="@(person.Value == Model.FoundById?.ToString() ? "selected" : null)">@person.Text</option>
                                }
                            }
                        </select>
                    </div>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <a asp-action="Search" class="btn btn-ghost btn-sm">
                        <i class="bi bi-x-circle me-1"></i> Clear Filters
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-search me-1"></i> Search
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Results -->
    <div class="card fade-in-up">
        <div class="card-body p-0">
            @if (Model.Results.Any())
            {
                <div class="table-responsive">
                    <table class="table-modern">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Date Found</th>
                                <th>Item</th>
                                <th>Location</th>
                                <th>Status</th>
                                <th>Days</th>
                                <th>Claimed By</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Results)
                            {
                                <tr>
                                    <td><strong>#@item.TrackingId</strong></td>
                                    <td>@item.DateFound.ToString("MM/dd/yyyy")</td>
                                    <td>@item.ItemName</td>
                                    <td>@item.LocationFound</td>
                                    <td><span class="badge-status badge-@item.StatusName.ToLower()">@item.StatusName</span></td>
                                    <td>
                                        @if (item.DaysSinceFound > 30)
                                        {
                                            <span class="text-danger fw-semibold">@item.DaysSinceFound</span>
                                        }
                                        else
                                        {
                                            @item.DaysSinceFound
                                        }
                                    </td>
                                    <td>@(item.ClaimedBy ?? "â€”")</td>
                                    <td>
                                        <div class="d-flex gap-1">
                                            <a asp-action="Details" asp-route-id="@item.TrackingId" class="btn btn-ghost btn-icon" title="View">
                                                <i class="bi bi-eye"></i>
                                            </a>
                                            <a asp-action="Edit" asp-route-id="@item.TrackingId" class="btn btn-ghost btn-icon" title="Edit">
                                                <i class="bi bi-pencil"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                @if (Model.TotalPages > 1)
                {
                    <div class="d-flex justify-content-between align-items-center px-3 py-3">
                        <span class="small text-muted">Page @Model.CurrentPage of @Model.TotalPages (@Model.TotalRecords records)</span>
                        <nav>
                            <ul class="pagination">
                                @if (Model.CurrentPage > 1)
                                {
                                    <li class="page-item">
                                        <a class="page-link" asp-action="Search"
                                           asp-route-CurrentPage="@(Model.CurrentPage - 1)"
                                           asp-route-TrackingId="@Model.TrackingId"
                                           asp-route-DateFoundFrom="@Model.DateFoundFrom?.ToString("yyyy-MM-dd")"
                                           asp-route-DateFoundTo="@Model.DateFoundTo?.ToString("yyyy-MM-dd")"
                                           asp-route-ItemId="@Model.ItemId"
                                           asp-route-StatusId="@Model.StatusId"
                                           asp-route-RouteId="@Model.RouteId"
                                           asp-route-VehicleId="@Model.VehicleId"
                                           asp-route-StorageLocationId="@Model.StorageLocationId"
                                           asp-route-FoundById="@Model.FoundById">
                                            <i class="bi bi-chevron-left"></i>
                                        </a>
                                    </li>
                                }
                                @for (var i = Math.Max(1, Model.CurrentPage - 2); i <= Math.Min(Model.TotalPages, Model.CurrentPage + 2); i++)
                                {
                                    <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                                        <a class="page-link" asp-action="Search"
                                           asp-route-CurrentPage="@i"
                                           asp-route-TrackingId="@Model.TrackingId"
                                           asp-route-DateFoundFrom="@Model.DateFoundFrom?.ToString("yyyy-MM-dd")"
                                           asp-route-DateFoundTo="@Model.DateFoundTo?.ToString("yyyy-MM-dd")"
                                           asp-route-ItemId="@Model.ItemId"
                                           asp-route-StatusId="@Model.StatusId"
                                           asp-route-RouteId="@Model.RouteId"
                                           asp-route-VehicleId="@Model.VehicleId"
                                           asp-route-StorageLocationId="@Model.StorageLocationId"
                                           asp-route-FoundById="@Model.FoundById">@i</a>
                                    </li>
                                }
                                @if (Model.CurrentPage < Model.TotalPages)
                                {
                                    <li class="page-item">
                                        <a class="page-link" asp-action="Search"
                                           asp-route-CurrentPage="@(Model.CurrentPage + 1)"
                                           asp-route-TrackingId="@Model.TrackingId"
                                           asp-route-DateFoundFrom="@Model.DateFoundFrom?.ToString("yyyy-MM-dd")"
                                           asp-route-DateFoundTo="@Model.DateFoundTo?.ToString("yyyy-MM-dd")"
                                           asp-route-ItemId="@Model.ItemId"
                                           asp-route-StatusId="@Model.StatusId"
                                           asp-route-RouteId="@Model.RouteId"
                                           asp-route-VehicleId="@Model.VehicleId"
                                           asp-route-StorageLocationId="@Model.StorageLocationId"
                                           asp-route-FoundById="@Model.FoundById">
                                            <i class="bi bi-chevron-right"></i>
                                        </a>
                                    </li>
                                }
                            </ul>
                        </nav>
                    </div>
                }
            }
            else
            {
                <div class="empty-state">
                    <i class="bi bi-search"></i>
                    <h3>No records found</h3>
                    <p>Try adjusting your search filters or create a new record.</p>
                </div>
            }
        </div>
    </div>
</div>
